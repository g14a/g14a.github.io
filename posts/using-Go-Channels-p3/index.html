<!DOCTYPE html> <html lang="en" > <head> <meta charset="utf-8"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Using Go Channels - Part 3 - Read/Write Channels &amp; Select | g14a</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="Using Go Channels - Part 3 - Read/Write Channels &amp; Select" /> <meta name="author" content="g14a" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A Tiny recap" /> <meta property="og:description" content="A Tiny recap" /> <link rel="canonical" href="https://g14a.github.io/posts/using-Go-Channels-p3/" /> <meta property="og:url" content="https://g14a.github.io/posts/using-Go-Channels-p3/" /> <meta property="og:site_name" content="g14a" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2021-04-10T13:23:00+05:30" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Using Go Channels - Part 3 - Read/Write Channels &amp; Select" /> <meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"g14a"},"dateModified":"2024-09-11T16:36:56+05:30","datePublished":"2021-04-10T13:23:00+05:30","description":"A Tiny recap","headline":"Using Go Channels - Part 3 - Read/Write Channels &amp; Select","mainEntityOfPage":{"@type":"WebPage","@id":"https://g14a.github.io/posts/using-Go-Channels-p3/"},"url":"https://g14a.github.io/posts/using-Go-Channels-p3/"}</script> <!-- End Jekyll SEO tag --> </head> <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta name="theme" content="Chirpy v2.7.2"> <meta name="google-site-verification" content="Uq5Ws_S7HFCjNgyIIOGXi76bInqos1mAvxiCrJspc8U" /> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Using Go Channels - Part 3 - Read/Write Channels &amp; Select | g14a</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="Using Go Channels - Part 3 - Read/Write Channels &amp; Select" /> <meta name="author" content="g14a" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A Tiny recap" /> <meta property="og:description" content="A Tiny recap" /> <link rel="canonical" href="https://g14a.github.io/posts/using-Go-Channels-p3/" /> <meta property="og:url" content="https://g14a.github.io/posts/using-Go-Channels-p3/" /> <meta property="og:site_name" content="g14a" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2021-04-10T13:23:00+05:30" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Using Go Channels - Part 3 - Read/Write Channels &amp; Select" /> <meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"g14a"},"dateModified":"2024-09-11T16:36:56+05:30","datePublished":"2021-04-10T13:23:00+05:30","description":"A Tiny recap","headline":"Using Go Channels - Part 3 - Read/Write Channels &amp; Select","mainEntityOfPage":{"@type":"WebPage","@id":"https://g14a.github.io/posts/using-Go-Channels-p3/"},"url":"https://g14a.github.io/posts/using-Go-Channels-p3/"}</script> <!-- End Jekyll SEO tag --> <title>Using Go Channels - Part 3 - Read/Write Channels & Select | g14a </title> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --> <link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"> <link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"> <link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"> <link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"> <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"> <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"> <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"> <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"> <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"> <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"> <link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"> <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"> <link rel="manifest" href="/assets/img/favicons/manifest.json"> <meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'> <meta name="msapplication-TileColor" content="#ffffff"> <meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"> <meta name="theme-color" content="#ffffff"> <!-- Google Fonts --> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"> <link rel="dns-prefetch" href="https://fonts.gstatic.com"> <!-- GA --> <link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"> <link rel="dns-prefetch" href="https://www.google-analytics.com"> <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"> <link rel="dns-prefetch" href="https://www.googletagmanager.com"> <!-- jsDelivr CDN --> <link rel="preconnect" href="cdn.jsdelivr.net"> <link rel="dns-prefetch" href="cdn.jsdelivr.net"> <!-- Bootstrap --> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"> <!-- Font Awesome --> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <link rel="preload" href="/assets/css/post.css" as="style"> <link rel="stylesheet" href="/assets/css/post.css"> <link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"> <link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <!-- JavaScripts --> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script async src="/assets/js/post.min.js"></script> <!-- PWA --> <script defer src="/app.js"></script> <!-- GA --> <!-- The GA snippet v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <!-- Global site tag (gtag.js) - Google Analytics --> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-5XJNKPTFP0"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-5XJNKPTFP0'); }); </script> </head> <body data-spy="scroll" data-target="#toc"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <div id="sidebar" class="d-flex flex-column align-items-end"> <div class="profile-wrapper text-center"> <div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/sample/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a> </div> <div class="site-title mt-3"> <a href="/">g14a</a> </div> <div class="site-subtitle font-italic">Thoughts and Knowledge.</div> </div><!-- .profile-wrapper --> <ul class="w-100"> <!-- home --> <li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a> </li> <!-- the real tabs --> <li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a> </li> <!-- .nav-item --> <li class="nav-item"> <a href="/tabs/opensource/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>OPEN SOURCE</span> </a> </li> <!-- .nav-item --> <li class="nav-item"> <a href="/tabs/projects/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>PROJECTS</span> </a> </li> <!-- .nav-item --> <li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a> </li> <!-- .nav-item --> <li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a> </li> <!-- .nav-item --> <li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a> </li> <!-- .nav-item --> </ul> <!-- ul.nav.flex-column --> <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/g14a" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['gowtham.m81197','gmail.com'].join('@')" aria-label="email" class="order-4" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/gowtham-munukutla/" aria-label="linkedin" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <!-- Switch the mode between dark and light. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> </div> <!-- .sidebar-bottom --> </div><!-- #sidebar --> <!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <div id="topbar-wrapper" class="row justify-content-center topbar-down"> <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Using Go Channels - Part 3 - Read/Write Channels & Select</span> </span><!-- endof #breadcrumb --> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i> <div id="topbar-title"> Post </div> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span> </div> </div> <div id="main-wrapper"> <div id="main"> <!-- Refactor the HTML structure. --> <!-- In order to allow a wide table to scroll horizontally, we suround the markdown table with `<div class="table-wrapper">` and `</div>` --> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --> <!-- Add attribute 'hide-bullet' to the checkbox list --> <!-- return --> <div class="row"> <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"> <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <h1 data-toc-skip>Using Go Channels - Part 3 - Read/Write Channels & Select</h1> <div class="post-meta text-muted d-flex flex-column"> <!-- Published date and author --> <div> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Apr 10, 2021, 1:23 PM +0530" > Apr 10, 2021 <i class="unloaded">2021-04-10T13:23:00+05:30</i> </span> by <span class="author"> g14a </span> </div> <div> <!-- lastmod --> <span> Updated <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Sep 11, 2024, 4:36 PM +0530" > Sep 11 <i class="unloaded">2024-09-11T16:36:56+05:30</i> </span> </span> <!-- read time --> <!-- Calculate the post's reading time, and display the word count in tooltip --> <!-- return element --> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2208 words">12 min</span> <!-- page views --> </div> </div> <!-- .post-meta --> <div class="post-content"> <!-- Using lozad. See: <https://github.com/ApoorvSaxena/lozad.js#usage> --> <h2 id="a-tiny-recap"><strong>A Tiny recap</strong></h2> <p>In the earlier section <a href="https://g14a.github.io/posts/using-Go-Channels-p2/">Part -2</a> , we have learnt:</p> <ul> <li>What buffered channels are</li> <li>Reading and writing to a buffered channel</li> <li>Communicating with goroutines with buffered channels</li> </ul> <p>Have you ever thought of what would happen if you’re on the receiver end of a channel and you accidentally close the channel? Or mistakenly try writing on a receiver end or reading from a sender end?</p> <p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://media.giphy.com/media/wQzqIYHE15zMI/giphy.gif" width="340" height="250" alt="" /></p> <p>To avoid these accidental errors, channels provide a better syntax to indicate whether a channel is just for reading or writing.</p> <h2 id="read-and-write-channels"><strong>Read and Write Channels</strong></h2> <p>First let’s try closing a channel on the receiver’s end.</p> <div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ch</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">int</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>

    <span class="k">go</span> <span class="n">send</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>

    <span class="nb">close</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>

    <span class="k">for</span> <span class="p">{</span>
        <span class="n">val</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="o">&lt;-</span> <span class="n">ch</span>
        <span class="k">if</span> <span class="n">ok</span> <span class="p">{</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">send</span><span class="p">(</span><span class="n">ch</span> <span class="k">chan</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="m">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">ch</span> <span class="o">&lt;-</span> <span class="n">i</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div> <p>When we run the above program, we get the following error:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>panic: send on closed channel

goroutine 6 <span class="o">[</span>running]:
main.send<span class="o">(</span>0xc000018080<span class="o">)</span>
        /Users/g14a/tutorials/img-proc/main.go:59 +0x45
created by main.main
        /Users/g14a/tutorials/img-proc/main.go:46 +0x5c
<span class="nb">exit </span>status 2
</pre></td></tr></tbody></table></code></div></div> <p>The error is self explanatory, we’re trying to send into a channel which has been closed by the receiver. Now how do we restrict a receiver from closing a channel but not the sender? By passing the <code class="language-plaintext highlighter-rouge">&lt;-</code> operator while initializing channels or when passing them.</p> <p>Let’s pass the channel to the <code class="language-plaintext highlighter-rouge">send</code> function as <code class="language-plaintext highlighter-rouge">ch chan &lt;- int</code> and seperate the reading of the channel into another function.</p> <div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"time"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ch</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">int</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>

    <span class="k">go</span> <span class="n">send</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
    <span class="k">go</span> <span class="n">read</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>

    <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Millisecond</span> <span class="o">*</span> <span class="m">100</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">send</span><span class="p">(</span><span class="n">ch</span> <span class="k">chan</span><span class="o">&lt;-</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="m">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">ch</span> <span class="o">&lt;-</span> <span class="n">i</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">read</span><span class="p">(</span><span class="n">ch</span> <span class="o">&lt;-</span><span class="k">chan</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="n">val</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">ch</span>
        <span class="k">if</span> <span class="n">ok</span> <span class="p">{</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div> <p>Notice how the parameters of <code class="language-plaintext highlighter-rouge">send</code> and <code class="language-plaintext highlighter-rouge">read</code> have <code class="language-plaintext highlighter-rouge">ch chan&lt;- int</code> and <code class="language-plaintext highlighter-rouge">ch &lt;-chan int</code> respectively. The syntax means that <code class="language-plaintext highlighter-rouge">send</code> only writes to a channel and <code class="language-plaintext highlighter-rouge">read</code> only reads from a channel.</p> <p>Now even if you try to close the channel in the <code class="language-plaintext highlighter-rouge">read</code> function before the <code class="language-plaintext highlighter-rouge">for</code> loop starts, it throws a syntax error like this.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c"># command-line-arguments</span>
./main.go:60:7: invalid operation: close<span class="o">(</span>ch<span class="o">)</span> <span class="o">(</span>cannot close receive-only channel<span class="o">)</span>
<span class="nv">$ </span><span class="o">&gt;</span>
</pre></td></tr></tbody></table></code></div></div> <p>Try writing into a channel in <code class="language-plaintext highlighter-rouge">read</code> now. And then try reading from the channel in the <code class="language-plaintext highlighter-rouge">send</code> function and see the output for yourself.</p> <div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="k">func</span> <span class="n">read</span><span class="p">(</span><span class="n">ch</span> <span class="o">&lt;-</span><span class="k">chan</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ch</span> <span class="o">&lt;-</span> <span class="m">10</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="n">val</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">ch</span>
        <span class="k">if</span> <span class="n">ok</span> <span class="p">{</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div> <p>It again throws a syntax error:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c"># command-line-arguments</span>
./main.go:60:5: invalid operation: ch &lt;- 10 <span class="o">(</span>send to receive-only <span class="nb">type</span> &lt;<span class="nt">-chan</span> int<span class="o">)</span>
<span class="nv">$ </span><span class="o">&gt;</span>
</pre></td></tr></tbody></table></code></div></div> <p>Now that we’ve understood the read/write channels and how we can avoid pitfalls and errors, lets move forward.</p> <p>As business and systems scale, there wouldn’t be just one goroutine in the application. There might be hundreds of them or even thousands. And these goroutines might be communicating between themselves via multiple channels. And sometimes when one goroutine blocks, the others keep running. So it implies that if one channel is waiting for data to come in, other channels already have data in it and are in need of a receiver i.e they are ready to deliver data. So is there a way we can use whatever data is incoming from whichever channel instead of waiting for whether or not the others have data? Absolutely.</p> <h2 id="select"><strong>Select</strong></h2> <p>The <code class="language-plaintext highlighter-rouge">select</code> keyword lets you get values out of simultaneously running goroutines. It is like a <code class="language-plaintext highlighter-rouge">switch</code> statement but for channel operations. There’s also a <code class="language-plaintext highlighter-rouge">default</code> case in <code class="language-plaintext highlighter-rouge">select</code> just like in a <code class="language-plaintext highlighter-rouge">switch</code> statement.</p> <p>The <code class="language-plaintext highlighter-rouge">select</code> statement does the following:</p> <ul> <li>Switches on channel operations to see which one can proceed immediately.</li> <li>If multiple channel operations aren’t blocking, it choses one of them at random.</li> <li>If all channel operations are blocking, it waits until one of them isn’t.</li> <li>If none of the channel operations can proceed, and there is a <code class="language-plaintext highlighter-rouge">default</code> case, it executes the <code class="language-plaintext highlighter-rouge">default</code> case.</li> </ul> <p>The <code class="language-plaintext highlighter-rouge">select</code> keyword is generally paired with the <code class="language-plaintext highlighter-rouge">for</code> loop in Go. We either loop infinitely if we have no clue about how much data we get into our channels, or in a <code class="language-plaintext highlighter-rouge">for range</code> loop.</p> <p>Let’s see how <code class="language-plaintext highlighter-rouge">select</code> works in the following program. We initialize two unbuffered channels <code class="language-plaintext highlighter-rouge">helloChan</code> and <code class="language-plaintext highlighter-rouge">worldChan</code> and pass data into it in two seperate goroutines. Notice how we didn’t use a <code class="language-plaintext highlighter-rouge">for</code> loop here because we know that only one data element is going to be received by the channel.</p> <div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"time"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">helloChan</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">string</span><span class="p">)</span>
    <span class="n">worldChan</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">string</span><span class="p">)</span>

    <span class="k">go</span> <span class="n">hello</span><span class="p">(</span><span class="n">helloChan</span><span class="p">)</span>
    <span class="k">go</span> <span class="n">world</span><span class="p">(</span><span class="n">worldChan</span><span class="p">)</span>

    <span class="k">select</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">msg</span> <span class="o">:=</span> <span class="o">&lt;-</span> <span class="n">helloChan</span><span class="o">:</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">case</span> <span class="n">msg</span> <span class="o">:=</span> <span class="o">&lt;-</span> <span class="n">worldChan</span><span class="o">:</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Millisecond</span><span class="o">*</span><span class="m">100</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">hello</span><span class="p">(</span><span class="n">helloChan</span> <span class="k">chan</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">helloChan</span> <span class="o">&lt;-</span> <span class="s">"Hello"</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">world</span><span class="p">(</span><span class="n">worldChan</span> <span class="k">chan</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">worldChan</span> <span class="o">&lt;-</span> <span class="s">"World!"</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div> <p>Upon running several times, we see <code class="language-plaintext highlighter-rouge">Hello</code> or <code class="language-plaintext highlighter-rouge">World!</code> in the output. This is because both of the channel operations at line 16 and 18 are non blocking. So any one of them is selected at random.</p> <p>Now let’s try blocking one of them by adding a <code class="language-plaintext highlighter-rouge">time.Sleep</code> before sending data into <code class="language-plaintext highlighter-rouge">helloChan</code>. Our <code class="language-plaintext highlighter-rouge">hello</code> functions becomes this.</p> <div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">func</span> <span class="n">hello</span><span class="p">(</span><span class="n">helloChan</span> <span class="k">chan</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Millisecond</span><span class="o">*</span><span class="m">100</span><span class="p">)</span>
    <span class="n">helloChan</span> <span class="o">&lt;-</span> <span class="s">"Hello"</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div> <p>Now the program always prints <code class="language-plaintext highlighter-rouge">World!</code> because the first case is blocking. We’re sleeping for 100ms before sending data into <code class="language-plaintext highlighter-rouge">helloChan</code> and by then, <code class="language-plaintext highlighter-rouge">worldChan</code> already has data in it ready to be delivered. So the <code class="language-plaintext highlighter-rouge">select</code> statement always executes the second case.</p> <p>Let’s try a send operation on a channel and see what happens:</p> <div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"time"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">helloChan</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">string</span><span class="p">)</span>
    <span class="n">worldChan</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">string</span><span class="p">)</span>

    <span class="k">go</span> <span class="n">hello</span><span class="p">(</span><span class="n">helloChan</span><span class="p">)</span>
    <span class="k">go</span> <span class="n">world</span><span class="p">(</span><span class="n">worldChan</span><span class="p">)</span>

    <span class="k">select</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">msg</span> <span class="o">:=</span> <span class="o">&lt;-</span> <span class="n">helloChan</span><span class="o">:</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">case</span> <span class="n">worldChan</span> <span class="o">&lt;-</span> <span class="s">"World"</span><span class="o">:</span>
    <span class="p">}</span>

    <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Millisecond</span><span class="o">*</span><span class="m">100</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">hello</span><span class="p">(</span><span class="n">helloChan</span> <span class="k">chan</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">helloChan</span> <span class="o">&lt;-</span> <span class="s">"Hello"</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">world</span><span class="p">(</span><span class="n">worldChan</span> <span class="k">chan</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">msg</span> <span class="o">:=</span> <span class="o">&lt;-</span> <span class="n">worldChan</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div> <p>This can either print out <code class="language-plaintext highlighter-rouge">Hello</code> or <code class="language-plaintext highlighter-rouge">World!</code>. Now its upto you, to try adding a blocking call by making one of the goroutines sleep for a while and explore all the combinations.</p> <p>Let’s try adding a default case and we see that it does something interesting. Our <code class="language-plaintext highlighter-rouge">select</code> statement becomes this:</p> <div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="k">select</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="o">:=</span> <span class="o">&lt;-</span> <span class="n">helloChan</span><span class="o">:</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">worldChan</span> <span class="o">&lt;-</span> <span class="s">"World"</span><span class="o">:</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"default case"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div> <p>Now we see that the program always prints <code class="language-plaintext highlighter-rouge">default</code> case. But we’ve seen that default case gets executed only when all the cases cannot proceed. But they were proceeding in the previous example when the <code class="language-plaintext highlighter-rouge">default</code> case wasn’t present. What is different now?</p> <p>In the third and fourth point of our <code class="language-plaintext highlighter-rouge">select</code> introduction we’ve seen that:</p> <blockquote> <p>If all channel operations are blocking, it waits until one of them isn’t.</p> </blockquote> <blockquote> <p>If none of the channel operations can proceed, and there is a <code class="language-plaintext highlighter-rouge">default</code> case, it executes the <code class="language-plaintext highlighter-rouge">default</code> case.</p> </blockquote> <p>So in the previous example, there is no <code class="language-plaintext highlighter-rouge">default</code> case. So <code class="language-plaintext highlighter-rouge">select</code> waited for atleast one of them to happen and executed that case immediately. But now since the <code class="language-plaintext highlighter-rouge">default</code> case exists, <code class="language-plaintext highlighter-rouge">select</code> doesn’t wait anymore and proceeds to run the default case. Try adding a sleep just before select and see what happens for yourself. That’s an exercise for you.</p> <p>Let’s see a real use case of <code class="language-plaintext highlighter-rouge">select</code>.</p> <div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>
	<span class="s">"time"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">helloChan</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">string</span><span class="p">,</span> <span class="m">5</span><span class="p">)</span>
    <span class="n">worldChan</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">string</span><span class="p">,</span> <span class="m">5</span><span class="p">)</span>

    <span class="k">go</span> <span class="n">hello</span><span class="p">(</span><span class="n">helloChan</span><span class="p">)</span>
    <span class="k">go</span> <span class="n">world</span><span class="p">(</span><span class="n">worldChan</span><span class="p">)</span>

    <span class="k">for</span> <span class="p">{</span>
        <span class="n">start</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="n">helloChan</span><span class="p">)</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="n">worldChan</span><span class="p">)</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Since</span><span class="p">(</span><span class="n">start</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">hello</span><span class="p">(</span><span class="n">helloChan</span> <span class="k">chan</span><span class="o">&lt;-</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="o">*</span><span class="m">1</span><span class="p">)</span>
        <span class="n">helloChan</span> <span class="o">&lt;-</span> <span class="s">"Hello"</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">world</span><span class="p">(</span><span class="n">worldChan</span> <span class="k">chan</span><span class="o">&lt;-</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Millisecond</span><span class="o">*</span><span class="m">500</span><span class="p">)</span>
        <span class="n">worldChan</span> <span class="o">&lt;-</span> <span class="s">"World!"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div> <p>When we run this we get the following output:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>Hello
World!
1.002727246s
Hello
World!
1.002881771s
Hello
World!
1.003041016s
Hello
World!
1.004952019s
...
<span class="nv">$ </span><span class="o">&gt;</span>
</pre></td></tr></tbody></table></code></div></div> <p>We see that every 1 second, we get both <code class="language-plaintext highlighter-rouge">Hello</code> and <code class="language-plaintext highlighter-rouge">World!</code> gets printed. But that’s not what we need. We need <code class="language-plaintext highlighter-rouge">World!</code> to be printed twice every one second because we’re waiting only 500ms before sending data into <code class="language-plaintext highlighter-rouge">worldChan</code>.</p> <p>So finally, by the end of 1 sec, we need <code class="language-plaintext highlighter-rouge">Hello</code> to be printed once, and <code class="language-plaintext highlighter-rouge">World!</code> to be printed twice. But this doesn’t happen because, the read at line no. 17 i.e <code class="language-plaintext highlighter-rouge">&lt;-helloChan</code> is a blocking one. It blocks until the one second gets over at line no. 25, and then it proceeds. Since it blocks, <code class="language-plaintext highlighter-rouge">&lt;-worldChan</code> doesn’t get called.</p> <p>Now lets replace the <code class="language-plaintext highlighter-rouge">for</code> loop with a for-select loop.</p> <div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">for</span> <span class="p">{</span>
    <span class="k">select</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">helloChan</span><span class="o">:</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">worldChan</span><span class="o">:</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div> <p>Now when we run this, we get the desired output:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>World!
Hello
World!
World!
Hello
World!
World!
Hello
World!
...
<span class="nv">$ </span><span class="o">&gt;</span>
</pre></td></tr></tbody></table></code></div></div> <p>The control flow can be understood better by the following picture.</p> <p> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="../../images/channels/select.png" width="60%" alt="" /> </p> <h2 id="timeouts-in-channels"><strong>Timeouts in channels</strong></h2> <p>In a HTTP environment, we talk about request timeouts. Where, if a request takes more than a certain period of time, we return a <code class="language-plaintext highlighter-rouge">408</code>. Similarly we have something in channels where if a channel operation takes more than a certain period, we execute something.</p> <p>You can imagine the usage of a timeout in a channel, where after time <code class="language-plaintext highlighter-rouge">t</code>, we send a message onto the channel saying “Hey, its time we did something else instead of waiting.”</p> <p>A basic timeout implementation can be done by the following</p> <div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>
	<span class="s">"time"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">helloChan</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">string</span><span class="p">,</span> <span class="m">5</span><span class="p">)</span>
    <span class="n">worldChan</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">string</span><span class="p">,</span> <span class="m">5</span><span class="p">)</span>
    <span class="n">timeoutChan</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">bool</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>

    <span class="k">go</span> <span class="n">hello</span><span class="p">(</span><span class="n">helloChan</span><span class="p">)</span>
    <span class="k">go</span> <span class="n">world</span><span class="p">(</span><span class="n">worldChan</span><span class="p">)</span>

    <span class="k">go</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="o">*</span><span class="m">3</span><span class="p">)</span>
        <span class="n">timeoutChan</span> <span class="o">&lt;-</span> <span class="no">true</span>
    <span class="p">}()</span>

    <span class="k">for</span> <span class="p">{</span>
        <span class="k">select</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">msg</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">helloChan</span><span class="o">:</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">case</span> <span class="n">msg</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">worldChan</span><span class="o">:</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">&lt;-</span><span class="n">timeoutChan</span><span class="o">:</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"It has been 3 seconds. Timeout!"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div> <p>When you run this, the program prints <code class="language-plaintext highlighter-rouge">It has been 3 seconds. Timeout!</code> every three seconds.</p> <p>Try blocking the <code class="language-plaintext highlighter-rouge">hello</code> and <code class="language-plaintext highlighter-rouge">world</code> functions for more than 3 seconds each, and add a return in the timeout case.</p> <div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"time"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">helloChan</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">string</span><span class="p">,</span> <span class="m">5</span><span class="p">)</span>
    <span class="n">worldChan</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">string</span><span class="p">,</span> <span class="m">5</span><span class="p">)</span>
    <span class="n">timeoutChan</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">bool</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>

    <span class="k">go</span> <span class="n">hello</span><span class="p">(</span><span class="n">helloChan</span><span class="p">)</span>
    <span class="k">go</span> <span class="n">world</span><span class="p">(</span><span class="n">worldChan</span><span class="p">)</span>

    <span class="k">go</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="o">*</span><span class="m">3</span><span class="p">)</span>
        <span class="n">timeoutChan</span> <span class="o">&lt;-</span> <span class="no">true</span>
    <span class="p">}()</span>

    <span class="k">for</span> <span class="p">{</span>
        <span class="k">select</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">msg</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">helloChan</span><span class="o">:</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">case</span> <span class="n">msg</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">worldChan</span><span class="o">:</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">&lt;-</span><span class="n">timeoutChan</span><span class="o">:</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"It has been 3 seconds. Timeout!"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">hello</span><span class="p">(</span><span class="n">helloChan</span> <span class="k">chan</span><span class="o">&lt;-</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="o">*</span><span class="m">5</span><span class="p">)</span>
        <span class="n">helloChan</span> <span class="o">&lt;-</span> <span class="s">"Hello"</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">world</span><span class="p">(</span><span class="n">worldChan</span> <span class="k">chan</span><span class="o">&lt;-</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="o">*</span><span class="m">5</span><span class="p">)</span>
        <span class="n">worldChan</span> <span class="o">&lt;-</span> <span class="s">"World!"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div> <p>Try running this and see the output for yourself.</p> <p>We used the <code class="language-plaintext highlighter-rouge">timeoutChan</code> for demonstration purposes but Go has something neat exactly for this functionality where we don’t have to make our own timeout channels. It’s the <code class="language-plaintext highlighter-rouge">time.After()</code> function that returns a channel and sends on it, after a certain period of time.</p> <p><a href="https://golang.org/pkg/time/#After">https://golang.org/pkg/time/#After</a></p> <p>The above example can be converted to the following and that’s all we have to do.</p> <div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">for</span> <span class="p">{</span>
    <span class="k">select</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">helloChan</span><span class="o">:</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">worldChan</span><span class="o">:</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">&lt;-</span><span class="n">time</span><span class="o">.</span><span class="n">After</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="o">*</span><span class="m">3</span><span class="p">)</span><span class="o">:</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"It has been 3 seconds. Timeout!"</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div> <h2 id="conclusion"><strong>Conclusion</strong></h2> <p>Hope you enjoyed the third part of the tutorial. In the next one we see a real world example of how we use channels.</p> <p>Check it out at <a href="https://g14a.github.io/posts/using-Go-Channels-p4/">Part-4 Image Processing with channels</a></p> <p>Please reach out to me via email(or any social media linked down below) if you think I haven’t covered something which you consider important.</p> <p>Thank you 😁</p> </div> <div class="post-tail-wrapper text-muted"> <!-- categories --> <div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tutorials/'>tutorials</a> </div> <!-- tags --> <div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/golang/" class="post-tag no-text-decoration" >golang</a> <a href="/tags/channels/" class="post-tag no-text-decoration" >channels</a> <a href="/tags/concurrency/" class="post-tag no-text-decoration" >concurrency</a> </div> <div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"> <div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author. </div> <!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --> <div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Using Go Channels - Part 3 - Read/Write Channels & Select - g14a&url=https://g14a.github.io/posts/using-Go-Channels-p3/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Using Go Channels - Part 3 - Read/Write Channels & Select - g14a&u=https://g14a.github.io/posts/using-Go-Channels-p3/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Using Go Channels - Part 3 - Read/Write Channels & Select - g14a&url=https://g14a.github.io/posts/using-Go-Channels-p3/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span> </div> </div><!-- .post-tail-bottom --> </div><!-- div.post-tail --> </div> <!-- .post --> </div> <!-- #post-wrapper --> <!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"> <div class="access"> <div id="access-lastmod" class="post"> <span>Recent Update</span> <ul class="post-content pl-0 pb-1 ml-1 mt-2"> <li><a href="/posts/interfaces/">How I learnt Go Interfaces</a></li> <li><a href="/posts/using-Go-Channels-p1/">Using Go Channels - Part 1 - Introduction to Channels</a></li> <li><a href="/posts/using-Go-Channels-p3/">Using Go Channels - Part 3 - Read/Write Channels & Select</a></li> <li><a href="/posts/using-Go-Channels-p4/">Using Go Channels - Part 4 - Image Processing with Channels</a></li> <li><a href="/posts/using-Go-Channels-p5/">Using Go Channels - Part 4 - Image Processing with Channels - Part 2</a></li> </ul> </div> <!-- #access-lastmod --> <div id="access-tags"> <span>Trending Tags</span> <div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/channels/">channels</a> <a class="post-tag" href="/tags/concurrency/">concurrency</a> <a class="post-tag" href="/tags/exercise/">exercise</a> <a class="post-tag" href="/tags/api/">api</a> <a class="post-tag" href="/tags/cache/">cache</a> <a class="post-tag" href="/tags/cli/">cli</a> <a class="post-tag" href="/tags/cobra/">cobra</a> <a class="post-tag" href="/tags/databases/">databases</a> <a class="post-tag" href="/tags/heroku/">heroku</a> </div> </div> </div> <!-- .access --> <div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span> <nav id="toc" data-toggle="toc"></nav> </div> </div> <!-- #panel-wrapper --> </div> <!-- .row --> <div class="row"> <div class="col-12 col-lg-11 col-xl-8"> <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Recommend the other 3 posts according to the tags and categories of the current post, if the number is not enough, use the other latest posts to supplement. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --> <!-- The total size of related posts --> <!-- An random integer that bigger than 0 --> <!-- Equals to TAG_SCORE / {max_categories_hierarchy} --> <!-- Fill with the other newlest posts --> <div id="related-posts" class="mt-5 mb-2 mb-sm-4"> <h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3> <div class="card-deck mb-4"> <div class="card"> <a href="/posts/using-Go-Channels-p1/"> <div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Apr 6, 2021 <i class="unloaded">2021-04-06T13:23:00+05:30</i> </span> <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Using Go Channels - Part 1 - Introduction to Channels</h3> <div class="text-muted small"> <p> Introduction We know that Goroutines are independently executing user space threads. Imagine an office workspace where ten employees are working towards a customer satisfying goal. These ten empl... </p> </div> </div> </a> </div> <div class="card"> <a href="/posts/using-Go-Channels-p2/"> <div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Apr 8, 2021 <i class="unloaded">2021-04-08T13:23:00+05:30</i> </span> <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Using Go Channels - Part 2 - Buffered Channels</h3> <div class="text-muted small"> <p> A Tiny Recap In the earlier section Part -1 , we have learnt: What channels are How we initialize them How we read from and write into a channel How we make goroutines communicate with c... </p> </div> </div> </a> </div> <div class="card"> <a href="/posts/using-Go-Channels-p4/"> <div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Apr 15, 2021 <i class="unloaded">2021-04-15T18:30:00+05:30</i> </span> <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Using Go Channels - Part 4 - Image Processing with Channels</h3> <div class="text-muted small"> <p> A Tiny Recap In the earlier section Part - 3 , we have learnt: What read and write specific channels are How we use select in the context of goroutines Finally, how we apply timeouts in se... </p> </div> </div> </a> </div> </div> <!-- .card-deck --> </div> <!-- #related-posts --> <!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <div class="post-navigation d-flex justify-content-between"> <a href="/posts/using-Go-Channels-p2/" class="btn btn-outline-primary"> <p>Using Go Channels - Part 2 - Buffered Channels</p> </a> <a href="/posts/using-Go-Channels-p4/" class="btn btn-outline-primary"> <p>Using Go Channels - Part 4 - Image Processing with Channels</p> </a> </div> </div> <!-- #post-extend-wrapper --> </div> <!-- .col-* --> </div> <!-- .row --> <!-- image lazy load: https://github.com/ApoorvSaxena/lozad.js --> <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <footer class="d-flex w-100 justify-content-center"> <div class="d-flex justify-content-between align-items-center"> <div class="footer-left"> <p class="mb-0"> © 2024 <a href="https://twitter.com/username">g14a</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span> </p> </div> <div class="footer-right"> <p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme. </p> </div> </div> <!-- div.d-flex --> </footer> </div> <!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <div id="search-result-wrapper" class="d-flex justify-content-center unloaded"> <div class="col-12 col-xl-11 post-content"> <div id="search-hints"> <h4 class="text-muted mb-4">Trending Tags</h4> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/channels/">channels</a> <a class="post-tag" href="/tags/concurrency/">concurrency</a> <a class="post-tag" href="/tags/exercise/">exercise</a> <a class="post-tag" href="/tags/api/">api</a> <a class="post-tag" href="/tags/cache/">cache</a> <a class="post-tag" href="/tags/cli/">cli</a> <a class="post-tag" href="/tags/cobra/">cobra</a> <a class="post-tag" href="/tags/databases/">databases</a> <a class="post-tag" href="/tags/heroku/">heroku</a> </div> <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div> </div> </div> </div> <!-- #main-wrapper --> <div id="mask"></div> <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://g14a.github.io{url}">{title}</a> <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> <div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div> <div><i class="fa fa-tag fa-fw"></i>{tags}</div> </div> <p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script> </body> </html>
