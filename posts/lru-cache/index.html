<!DOCTYPE html> <html lang="en" > <head> <meta charset="utf-8"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>LRU Cache Using Go in under 100 lines! | g14a</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="LRU Cache Using Go in under 100 lines!" /> <meta name="author" content="g14a" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Vague introduction to LRU Caches" /> <meta property="og:description" content="Vague introduction to LRU Caches" /> <link rel="canonical" href="https://g14a.github.io/posts/lru-cache/" /> <meta property="og:url" content="https://g14a.github.io/posts/lru-cache/" /> <meta property="og:site_name" content="g14a" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2022-02-05T09:03:00+05:30" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="LRU Cache Using Go in under 100 lines!" /> <meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"g14a"},"dateModified":"2022-02-05T09:03:00+05:30","datePublished":"2022-02-05T09:03:00+05:30","description":"Vague introduction to LRU Caches","headline":"LRU Cache Using Go in under 100 lines!","mainEntityOfPage":{"@type":"WebPage","@id":"https://g14a.github.io/posts/lru-cache/"},"url":"https://g14a.github.io/posts/lru-cache/"}</script> <!-- End Jekyll SEO tag --> </head> <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy ¬© 2017-2019 Cotes Chung MIT License --> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta name="theme" content="Chirpy v2.7.2"> <meta name="google-site-verification" content="Uq5Ws_S7HFCjNgyIIOGXi76bInqos1mAvxiCrJspc8U" /> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>LRU Cache Using Go in under 100 lines! | g14a</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="LRU Cache Using Go in under 100 lines!" /> <meta name="author" content="g14a" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Vague introduction to LRU Caches" /> <meta property="og:description" content="Vague introduction to LRU Caches" /> <link rel="canonical" href="https://g14a.github.io/posts/lru-cache/" /> <meta property="og:url" content="https://g14a.github.io/posts/lru-cache/" /> <meta property="og:site_name" content="g14a" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2022-02-05T09:03:00+05:30" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="LRU Cache Using Go in under 100 lines!" /> <meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"g14a"},"dateModified":"2022-02-05T09:03:00+05:30","datePublished":"2022-02-05T09:03:00+05:30","description":"Vague introduction to LRU Caches","headline":"LRU Cache Using Go in under 100 lines!","mainEntityOfPage":{"@type":"WebPage","@id":"https://g14a.github.io/posts/lru-cache/"},"url":"https://g14a.github.io/posts/lru-cache/"}</script> <!-- End Jekyll SEO tag --> <title>LRU Cache Using Go in under 100 lines! | g14a </title> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy ¬© 2019 Cotes Chung Published under the MIT license --> <link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"> <link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"> <link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"> <link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"> <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"> <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"> <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"> <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"> <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"> <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"> <link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"> <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"> <link rel="manifest" href="/assets/img/favicons/manifest.json"> <meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'> <meta name="msapplication-TileColor" content="#ffffff"> <meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"> <meta name="theme-color" content="#ffffff"> <!-- Google Fonts --> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"> <link rel="dns-prefetch" href="https://fonts.gstatic.com"> <!-- GA --> <link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"> <link rel="dns-prefetch" href="https://www.google-analytics.com"> <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"> <link rel="dns-prefetch" href="https://www.googletagmanager.com"> <!-- jsDelivr CDN --> <link rel="preconnect" href="cdn.jsdelivr.net"> <link rel="dns-prefetch" href="cdn.jsdelivr.net"> <!-- Bootstrap --> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"> <!-- Font Awesome --> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy ¬© 2020 Cotes Chung MIT Licensed --> <link rel="preload" href="/assets/css/post.css" as="style"> <link rel="stylesheet" href="/assets/css/post.css"> <link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"> <link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <!-- JavaScripts --> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy ¬© 2020 Cotes Chung MIT Licensed --> <script async src="/assets/js/post.min.js"></script> <!-- PWA --> <script defer src="/app.js"></script> <!-- GA --> <!-- The GA snippet v2.0 https://github.com/cotes2020/jekyll-theme-chirpy ¬© 2017-2019 Cotes Chung MIT License --> <!-- Global site tag (gtag.js) - Google Analytics --> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-5XJNKPTFP0"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-5XJNKPTFP0'); }); </script> </head> <body data-spy="scroll" data-target="#toc"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy ¬© 2017-2019 Cotes Chung MIT License --> <div id="sidebar" class="d-flex flex-column align-items-end"> <div class="profile-wrapper text-center"> <div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/sample/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a> </div> <div class="site-title mt-3"> <a href="/">g14a</a> </div> <div class="site-subtitle font-italic">Thoughts and Knowledge.</div> </div><!-- .profile-wrapper --> <ul class="w-100"> <!-- home --> <li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a> </li> <!-- the real tabs --> <li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a> </li> <!-- .nav-item --> <li class="nav-item"> <a href="/tabs/opensource/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>OPEN SOURCE</span> </a> </li> <!-- .nav-item --> <li class="nav-item"> <a href="/tabs/projects/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>PROJECTS</span> </a> </li> <!-- .nav-item --> <li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a> </li> <!-- .nav-item --> <li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a> </li> <!-- .nav-item --> <li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a> </li> <!-- .nav-item --> </ul> <!-- ul.nav.flex-column --> <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/g14a" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['gowtham.m81197','gmail.com'].join('@')" aria-label="email" class="order-4" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/gowtham-munukutla/" aria-label="linkedin" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <!-- Switch the mode between dark and light. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy ¬© 2020 Cotes Chung MIT License --> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG ‚Ä∫ <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> </div> <!-- .sidebar-bottom --> </div><!-- #sidebar --> <!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy ¬© 2017-2019 Cotes Chung MIT License --> <div id="topbar-wrapper" class="row justify-content-center topbar-down"> <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>LRU Cache Using Go in under 100 lines!</span> </span><!-- endof #breadcrumb --> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i> <div id="topbar-title"> Post </div> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span> </div> </div> <div id="main-wrapper"> <div id="main"> <!-- Refactor the HTML structure. --> <!-- In order to allow a wide table to scroll horizontally, we suround the markdown table with `<div class="table-wrapper">` and `</div>` --> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --> <!-- Add attribute 'hide-bullet' to the checkbox list --> <!-- return --> <div class="row"> <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"> <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <h1 data-toc-skip>LRU Cache Using Go in under 100 lines!</h1> <div class="post-meta text-muted d-flex flex-column"> <!-- Published date and author --> <div> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy ¬© 2020 Cotes Chung MIT License --> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Feb 5, 2022, 9:03 AM +0530" > Feb 5, 2022 <i class="unloaded">2022-02-05T09:03:00+05:30</i> </span> by <span class="author"> g14a </span> </div> <div> <!-- lastmod --> <!-- read time --> <!-- Calculate the post's reading time, and display the word count in tooltip --> <!-- return element --> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="784 words">4 min</span> <!-- page views --> </div> </div> <!-- .post-meta --> <div class="post-content"> <!-- Using lozad. See: <https://github.com/ApoorvSaxena/lozad.js#usage> --> <h2 id="vague-introduction-to-lru-caches">Vague introduction to LRU Caches</h2> <p>Hello fellow internet user! I assume you know what caches are and how they work. Today let‚Äôs see how we can design an LRU cache using our favourite language Go with as little code as possible.</p> <p>LRU when expanded is <u>L</u>east <u>R</u>ecently <u>U</u>sed.</p> <p>So it basically means whichever entry is the least used after we put it, will be kicked out and replaced by a new entry. This is of course limited by the capacity of the cache. In an ideal world if you have unlimited storage capacity you don‚Äôt need this at all. So go back to enjoying life without performance issues.</p> <p>I recommend you learn about how LRU caches work because we‚Äôre here to implement the same in Go but not understand the mechanics of it.</p> <h2 id="needed-functions">Needed functions</h2> <p>Just like all caches we will need two most important functions which work on it.</p> <ul> <li><code class="language-plaintext highlighter-rouge">Put(key, value)</code> - Which creates an entry at a key.</li> <li><code class="language-plaintext highlighter-rouge">Get(key)</code> - Which retrieves a values at a key and returns <code class="language-plaintext highlighter-rouge">nil</code> if it doesn‚Äôt find it.</li> </ul> <h2 id="a-little-theory">A little theory</h2> <p>We will need a hashmap or a dictionary or a key value store if you will, and a doubly linked list(DLL) to implement an LRU cache.</p> <p>The DLL will store the actual values of the cache and the map will store the address of the value in the DLL against a key.</p> <p>So the map looks something like this:</p><pre><code class="language-JSON">{
    "key": &lt;node-address-of-DLL&gt;
}
</code></pre><p>Are we going to implement a DLL from scratch? No. We will use the <code class="language-plaintext highlighter-rouge">container/list</code> data structure in Go‚Äôs standard library which is a fully functional and tested implementation of a DLL.</p> <h2 id="put">Put</h2> <p>We will work with integers for now so let us initialize an <code class="language-plaintext highlighter-rouge">LRUCache</code> object first and then a hashmap:</p> <div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">type</span> <span class="n">LRUCache</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">Cache</span> <span class="o">*</span><span class="n">list</span><span class="o">.</span><span class="n">List</span>
<span class="p">}</span>

<span class="k">var</span> <span class="n">hashMap</span> <span class="o">=</span> <span class="k">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="o">*</span><span class="n">list</span><span class="o">.</span><span class="n">Element</span><span class="p">{}</span>
</pre></td></tr></tbody></table></code></div></div> <p>We implement a receiver function on this object called <code class="language-plaintext highlighter-rouge">Put()</code>.</p> <p>Now the <code class="language-plaintext highlighter-rouge">Put</code> method creates an entry in the cache if there is extra space in it to create data. If the capacity overflows, it removes the least recently used entry(from the back of the DLL) and proceeds to push the new entry to the front.</p> <div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">func</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span><span class="n">LRUCache</span><span class="p">)</span> <span class="n">Put</span><span class="p">(</span><span class="n">key</span> <span class="kt">int</span><span class="p">,</span> <span class="n">value</span> <span class="kt">int</span><span class="p">)</span> <span class="k">interface</span><span class="p">{}</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">Cache</span><span class="o">.</span><span class="n">Len</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">cacheLength</span> <span class="p">{</span>
        <span class="n">elem</span> <span class="o">:=</span> <span class="n">l</span><span class="o">.</span><span class="n">Cache</span><span class="o">.</span><span class="n">PushFront</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">hashMap</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="p">}</span>
    <span class="n">l</span><span class="o">.</span><span class="n">Cache</span><span class="o">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">Cache</span><span class="o">.</span><span class="n">Back</span><span class="p">())</span>
    <span class="n">elem</span> <span class="o">:=</span> <span class="n">l</span><span class="o">.</span><span class="n">Cache</span><span class="o">.</span><span class="n">PushFront</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">hashMap</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span>
    <span class="k">return</span> <span class="n">value</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div> <p>When we push an entry to a DLL it returns the memory address of the same, which we store in the hashmap.</p> <h2 id="get">Get</h2> <p>Get isn‚Äôt necessarily just a read operation in case of an LRU cache. Since we‚Äôre keeping track of the least recently used entries, we make sure the entries being retrieved by <code class="language-plaintext highlighter-rouge">Get</code> are available at the front of the DLL for immediate future use. We do that just by removing the node we just retrieved, push the value at the front again and store the new address in the hashmap.</p> <div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">func</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span><span class="n">LRUCache</span><span class="p">)</span> <span class="n">Get</span><span class="p">(</span><span class="n">key</span> <span class="kt">int</span><span class="p">)</span> <span class="k">interface</span><span class="p">{}</span> <span class="p">{</span>
    <span class="n">node</span> <span class="o">:=</span> <span class="n">hashMap</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="m">1</span>
    <span class="p">}</span>
    <span class="n">value</span> <span class="o">:=</span> <span class="n">node</span><span class="o">.</span><span class="n">Value</span>
    <span class="n">l</span><span class="o">.</span><span class="n">Cache</span><span class="o">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">newPositionElem</span> <span class="o">:=</span> <span class="n">l</span><span class="o">.</span><span class="n">Cache</span><span class="o">.</span><span class="n">PushFront</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">hashMap</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">newPositionElem</span>
    <span class="k">return</span> <span class="n">value</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div> <p>We implement a <code class="language-plaintext highlighter-rouge">Print</code> function to iterate the DLL to know the state of the cache at runtime.</p> <div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="k">func</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span><span class="n">LRUCache</span><span class="p">)</span> <span class="n">Print</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">element</span> <span class="o">:=</span> <span class="n">l</span><span class="o">.</span><span class="n">Cache</span><span class="o">.</span><span class="n">Front</span><span class="p">();</span> <span class="n">element</span> <span class="o">!=</span> <span class="no">nil</span><span class="p">;</span> <span class="n">element</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">Next</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">Value</span><span class="p">,</span> <span class="s">"--&gt;"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">()</span>
<span class="p">}</span>

</pre></td></tr></tbody></table></code></div></div> <h2 id="api">API</h2> <p>Let‚Äôs add an API around the LRU cache we just created with two endpoints, GET and PUT. It‚Äôs a simple API. We‚Äôre not adding extra validations for HTTP methods or json serializtion.</p> <div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="k">func</span> <span class="n">GetRoute</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">params</span> <span class="o">:=</span> <span class="n">mux</span><span class="o">.</span><span class="n">Vars</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

    <span class="n">getValue</span> <span class="o">:=</span> <span class="n">params</span><span class="p">[</span><span class="s">"string"</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">:=</span> <span class="n">cache</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">getValue</span><span class="p">)</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">Print</span><span class="p">()</span>
    <span class="n">bytes</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">json</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">bytes</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">PutRoute</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">params</span> <span class="o">:=</span> <span class="n">mux</span><span class="o">.</span><span class="n">Vars</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

    <span class="n">value</span> <span class="o">:=</span> <span class="n">params</span><span class="p">[</span><span class="s">"integer"</span><span class="p">]</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">strconv</span><span class="o">.</span><span class="n">Atoi</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="n">key</span> <span class="o">:=</span> <span class="n">strconv</span><span class="o">.</span><span class="n">Itoa</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">insertedValue</span> <span class="o">:=</span> <span class="n">cache</span><span class="o">.</span><span class="n">Put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">Print</span><span class="p">()</span>
    <span class="n">bytes</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">json</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">insertedValue</span><span class="p">)</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">bytes</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div> <p>Here‚Äôs the gist of the whole implementation - <a href="https://gist.github.com/g14a/2be6e3768882d8369a360b98abd13343">LRU Cache</a></p> <p>Make sure you check the logs to know how the DLL is being manipulated.</p> <h2 id="conclusion">Conclusion</h2> <p>Let me know if I can improve better or any areas where I have gone wrong.</p> <p>Please reach out to me via email(or any social media linked down below) if you think I haven‚Äôt covered something which you consider important.</p> <p>Thank you üòÅ</p> </div> <div class="post-tail-wrapper text-muted"> <!-- categories --> <div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tutorials/'>tutorials</a> </div> <!-- tags --> <div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/lru/" class="post-tag no-text-decoration" >lru</a> <a href="/tags/cache/" class="post-tag no-text-decoration" >cache</a> <a href="/tags/golang/" class="post-tag no-text-decoration" >golang</a> <a href="/tags/api/" class="post-tag no-text-decoration" >api</a> </div> <div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"> <div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author. </div> <!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy ¬© 2019 Cotes Chung Published under the MIT License --> <div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=LRU Cache Using Go in under 100 lines! - g14a&url=https://g14a.github.io/posts/lru-cache/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=LRU Cache Using Go in under 100 lines! - g14a&u=https://g14a.github.io/posts/lru-cache/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=LRU Cache Using Go in under 100 lines! - g14a&url=https://g14a.github.io/posts/lru-cache/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span> </div> </div><!-- .post-tail-bottom --> </div><!-- div.post-tail --> </div> <!-- .post --> </div> <!-- #post-wrapper --> <!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy ¬© 2017-2019 Cotes Chung MIT License --> <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"> <div class="access"> <div id="access-lastmod" class="post"> <span>Recent Update</span> <ul class="post-content pl-0 pb-1 ml-1 mt-2"> <li><a href="/posts/interfaces/">How I learnt Go Interfaces</a></li> <li><a href="/posts/using-Go-Channels-p1/">Using Go Channels - Part 1 - Introduction to Channels</a></li> <li><a href="/posts/using-Go-Channels-p3/">Using Go Channels - Part 3 - Read/Write Channels & Select</a></li> <li><a href="/posts/using-Go-Channels-p4/">Using Go Channels - Part 4 - Image Processing with Channels</a></li> <li><a href="/posts/using-Go-Channels-p5/">Using Go Channels - Part 4 - Image Processing with Channels - Part 2</a></li> </ul> </div> <!-- #access-lastmod --> <div id="access-tags"> <span>Trending Tags</span> <div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/channels/">channels</a> <a class="post-tag" href="/tags/concurrency/">concurrency</a> <a class="post-tag" href="/tags/exercise/">exercise</a> <a class="post-tag" href="/tags/api/">api</a> <a class="post-tag" href="/tags/cache/">cache</a> <a class="post-tag" href="/tags/cli/">cli</a> <a class="post-tag" href="/tags/cobra/">cobra</a> <a class="post-tag" href="/tags/databases/">databases</a> <a class="post-tag" href="/tags/heroku/">heroku</a> </div> </div> </div> <!-- .access --> <div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span> <nav id="toc" data-toggle="toc"></nav> </div> </div> <!-- #panel-wrapper --> </div> <!-- .row --> <div class="row"> <div class="col-12 col-lg-11 col-xl-8"> <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Recommend the other 3 posts according to the tags and categories of the current post, if the number is not enough, use the other latest posts to supplement. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy ¬© 2019 Cotes Chung Published under the MIT License --> <!-- The total size of related posts --> <!-- An random integer that bigger than 0 --> <!-- Equals to TAG_SCORE / {max_categories_hierarchy} --> <!-- Fill with the other newlest posts --> <div id="related-posts" class="mt-5 mb-2 mb-sm-4"> <h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3> <div class="card-deck mb-4"> <div class="card"> <a href="/posts/Testing-Cobra-Subcommands/"> <div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy ¬© 2020 Cotes Chung MIT License --> <span class="timeago small" > Jun 14, 2021 <i class="unloaded">2021-06-14T22:30:00+05:30</i> </span> <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Testing Cobra Subcommands</h3> <div class="text-muted small"> <p> Just an Intro Go has been around for more than 10 years now. Recently more than a dozen tools and frameworks have come out making us create CLI apps easily than ever. Out of those countless tools,... </p> </div> </div> </a> </div> <div class="card"> <a href="/posts/schema-migrations-heroku/"> <div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy ¬© 2020 Cotes Chung MIT License --> <span class="timeago small" > Nov 28, 2020 <i class="unloaded">2020-11-28T09:03:00+05:30</i> </span> <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Running schema migrations on Heroku</h3> <div class="text-muted small"> <p> This is a quick article on how schema migrations are run beforing deploying your Go application(or any another app) on Heroku. I‚Äôve myself faced some problems due to lack of proper documentation wi... </p> </div> </div> </a> </div> <div class="card"> <a href="/posts/interfaces/"> <div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy ¬© 2020 Cotes Chung MIT License --> <span class="timeago small" > Dec 11, 2020 <i class="unloaded">2020-12-11T20:50:00+05:30</i> </span> <h3 class="pt-0 mt-1 mb-3" data-toc-skip>How I learnt Go Interfaces</h3> <div class="text-muted small"> <p> Intro It is a general phenomenon among humans (I mean our brain) to not notice things which are similar. You might understand this article better if you start looking at things a different way. I... </p> </div> </div> </a> </div> </div> <!-- .card-deck --> </div> <!-- #related-posts --> <!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy ¬© 2020 Cotes Chung MIT License --> <div class="post-navigation d-flex justify-content-between"> <a href="/posts/channels-and-deadlocks/" class="btn btn-outline-primary"> <p>Channels and Deadlocks in Go with a File crawler</p> </a> <span class="btn btn-outline-primary disabled"> <p>-</p> </span> </div> </div> <!-- #post-extend-wrapper --> </div> <!-- .col-* --> </div> <!-- .row --> <!-- image lazy load: https://github.com/ApoorvSaxena/lozad.js --> <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy ¬© 2017-2019 Cotes Chung MIT License --> <footer class="d-flex w-100 justify-content-center"> <div class="d-flex justify-content-between align-items-center"> <div class="footer-left"> <p class="mb-0"> ¬© 2024 <a href="https://twitter.com/username">g14a</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span> </p> </div> <div class="footer-right"> <p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme. </p> </div> </div> <!-- div.d-flex --> </footer> </div> <!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy ¬© 2017-2019 Cotes Chung MIT License --> <div id="search-result-wrapper" class="d-flex justify-content-center unloaded"> <div class="col-12 col-xl-11 post-content"> <div id="search-hints"> <h4 class="text-muted mb-4">Trending Tags</h4> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/channels/">channels</a> <a class="post-tag" href="/tags/concurrency/">concurrency</a> <a class="post-tag" href="/tags/exercise/">exercise</a> <a class="post-tag" href="/tags/api/">api</a> <a class="post-tag" href="/tags/cache/">cache</a> <a class="post-tag" href="/tags/cli/">cli</a> <a class="post-tag" href="/tags/cobra/">cobra</a> <a class="post-tag" href="/tags/databases/">databases</a> <a class="post-tag" href="/tags/heroku/">heroku</a> </div> <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div> </div> </div> </div> <!-- #main-wrapper --> <div id="mask"></div> <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy ¬© 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://g14a.github.io{url}">{title}</a> <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> <div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div> <div><i class="fa fa-tag fa-fw"></i>{tags}</div> </div> <p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script> </body> </html>
